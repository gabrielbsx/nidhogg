var OngameBar={domain:null,environment:null,language:null,locale:null,protocol:null,show_flag:!1,theme:null,user:null,host:null,site:"",url:null,version:"3.0.28",bar_selector:null,init:function(){this.url=document.querySelector('script[data-bar="Ongame"]').src,this.insert_bar_tag(),this.load_parameters()},load_parameters:function(){for(var e=this.url.split("?")[1].split("&"),t=e.length-1;t>=0;t--){var a=e[t].split("="),n=a[0],i=a[1];"theme"===n?this.theme=parseInt(i):"show_flag"===n?"true"===i&&(this.show_flag=!0):"language"===n&&(this.language=i.toLowerCase())}this.load_hosts()},load_hosts:function(){var e=this.url.split("://"),t=e[1].split("index.html");if(this.protocol=e[0],t[0].indexOf("localhost")<0||t[0].indexOf("10.0.")<0){var a="",n=t[0].split(".")[2];this.environment="net"!==n&&"teste"!==n?"net":n,this.host=window.location.href.split(OngameBar.environment)[0]+OngameBar.environment,"es"===this.language?(a="la",this.minha_conta="micuenta.ongame."+this.environment,this.loja="tienda.ongame."+this.environment,this.flag=this.host.replace("la.","br."),this.flag=this.flag.replace("micuenta.","minhaconta."),this.flag=this.flag.replace("tienda.","loja."),this.flag=this.flag.replace("soporte.","suporte.")):(a="br",this.minha_conta="minhaconta.ongame."+this.environment,this.loja="loja.ongame."+this.environment,this.flag=this.host.replace("br.","la."),this.flag=this.flag.replace("minhaconta.","micuenta."),this.flag=this.flag.replace("loja.","tienda."),this.flag=this.flag.replace("suporte.","soporte.")),this.domain=a+".ongame."+this.environment,this.portal=a+".ongame."+this.environment,this.status=a+".status.ongame."+this.environment;var i=window.location.host.split(".");switch(i[0]){case"pb":this.site="point-blank";break;case"aika":this.site="aika";break;case"m2":this.site="metin-2";break;case"tr":this.site="trigger-run";break;case"kr":this.site="kritika";break;case"itemmall":case"mercado":"pb"===i[1]?this.site="point-blank":"aika"===i[1]?this.site="aika":"m2"===i[1]?this.site="metin-2":this.site="ongame";break;default:this.site="ongame"}}else this.domain=t[0].split(":")[0],this.environment="dev",this.minha_conta=this.domain+":8001",this.loja=this.domain+":8007",this.portal=this.domain+":8008",this.status=this.domain+":8013",this.flag=window.location.href;this.load_template()},insert_bar_tag:function(){var e=document.createElement("div");e.id="ongame-bar",document.body.insertBefore(e,document.body.firstChild),this.bar_selector=document.querySelector("#ongame-bar"),this.bar_selector.nextElementSibling.style.paddingTop="41px"},load_template:function(){var e=this,t="ongame-bar-"+e.language+"-"+e.version,a=localStorage.getItem(t);if(a)e.set_template(a);else{var n=new XMLHttpRequest;n.open("GET/index.html",e.protocol+"://"+e.domain+"/bar/bar-"+e.language+".html",!0),n.onload=function(){if(n.status>=200&&n.status<400){var a=n.responseText;localStorage.setItem(t,a),e.set_template(a)}},n.onerror=function(){},n.send()}},set_template:function(e){this.bar_selector.insertAdjacentHTML("afterbegin",this.set_template_tags(e)),"es"!==this.language?this.bar_selector.classList.add("ongame-bar--br"):this.bar_selector.classList.add("ongame-bar--es"),this.load_login(),this.game_menu(),this.scroll(),this.show_flag&&this.bar_selector.classList.add("ongame-bar--language"),15===this.theme&&document.querySelector(".ongame-bar__loja").classList.add("esconder")},set_template_tags:function(e){var t=new Date;function a(t,a){e=e.replace(/{{ /g,"{{").replace(/ }}/g,"}}").replace(new RegExp("{{"+t+"}}","g"),a)}return a("environment",this.environment),a("minha_conta",this.minha_conta),a("protocol",this.protocol),a("portal",this.portal),a("status",this.status),a("theme",this.theme),a("loja",this.loja),a("site",this.site),a("flag",this.flag),a("year",t.getFullYear()),a("url",window.location.href),e},load_login:function(){var e=this.get_cookie("OGU");if(e){var t=e,a=this.get_cookie("OGN");a&&(t=a),this.bar_selector.classList.add("ongame-bar--logged"),4===this.theme&&(this.bar_selector.classList.add("ongame-bar--m2"),this.m2_config()),document.querySelector(".ongame-bar__username").textContent=t,"True"===this.get_cookie("OGT")&&this.bar_selector.classList.add("ongame-bar--blocked")}},csrf_safe_method:function(e){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(e)},get_cookie:function(e){var t=null;if(document.cookie&&""!==document.cookie)for(var a=document.cookie.split(";"),n=0;n<a.length;n++){var i=a[n].trim();if(i.substring(0,e.length+1)===e+"="){t=decodeURIComponent(i.substring(e.length+1));break}}return t},game_menu:function(){var e,t=document.querySelectorAll(".js-ongame-bar-img-zoom"),a=t[0].offsetWidth,n=t[2].offsetWidth;if(!document.querySelector(".ongame-bar__mobile").offsetParent){for(var i=t.length-1;i>=0;i--)t[i].setAttribute("data-index",i),t[i].addEventListener("mouseover",function(){e=this.querySelector("img").offsetWidth,this.style.width=e+"px"}),t[i].addEventListener("mouseout",function(){"0"!==this.getAttribute("data-index")&&"1"!==this.getAttribute("data-index")?this.style.width=n+"px":this.style.width=a+"px"});window.addEventListener("resize",function(){!function(){for(var e=t.length-1;e>=0;e--)t[e].style.width=n+"px";t[0].style.width=a+"px",t[1].style.width=a+"px",a=t[0].offsetWidth,n=t[2].offsetWidth}()})}var s=!1,o=document.querySelector(".js-ongame-bar-game-menu");o.onmousedown=function(){s=!1,this.classList.add("active"),this.focus(),setTimeout(function(){s=!0,o.focus()},100)},o.onblur=function(){s&&this.classList.remove("active")}},m2_config:function(){var e=this;function t(t){var a=new XMLHttpRequest;a.open("POST/index.html",t,!0),a.setRequestHeader("X-CSRFToken",e.get_cookie("csrftoken")),a.onload=function(){if(a.status>=200&&a.status<400){var e=JSON.parse(a.response);"ok"===e.status?alert("Foi enviado um link em seu e-mail para trocar sua senha."):"login"===e.status?alert("Efetue o login no site novamente."):"inactive"===e.status&&alert("Você precisa logar na sua conta antes de alterar a senha.")}else alert("Houve um erro na requisição. Tente mais tarde.")},a.onerror=function(){alert("Houve um erro na requisição. Tente mais tarde.")},a.send()}document.querySelector(".ongame-bar__m2-personagem").onclick=function(){t("//m2.ongame."+e.environment+"/enviar-senha-personagem/")},document.querySelector(".ongame-bar__m2-armazem").onclick=function(){t("//m2.ongame."+e.environment+"/enviar-senha-armazem/")}},scroll:function(){var e=this,t=0,a=0;window.addEventListener("scroll",function(){(t=window.pageYOffset||document.documentElement.scrollTop)>41&&t>a?e.bar_selector.classList.add("ongame-bar--hide"):e.bar_selector.classList.remove("ongame-bar--hide"),a=t})}};!function(){var e=setInterval(function(){document.body&&document.body.childElementCount>0&&(clearInterval(e),OngameBar.init())},100)}();